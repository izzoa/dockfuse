version: '3'

services:
  dockfuse:
    build:
      context: ./src
    container_name: dockfuse
    privileged: true
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - S3_BUCKET=${S3_BUCKET}
      - S3_PATH=${S3_PATH:-/}
      - MOUNT_POINT=/mnt/s3bucket
      - S3_URL=${S3_URL:-https://s3.amazonaws.com}
      - S3FS_OPTIONS=use_path_request_style,rw,allow_other,use_cache=/tmp,max_stat_cache_size=1000,stat_cache_expire=900,nonempty
      - DEBUG=1
    volumes:
      - s3data:/mnt/s3bucket
    restart: unless-stopped
    command: daemon

volumes:
  s3data:
    driver: local